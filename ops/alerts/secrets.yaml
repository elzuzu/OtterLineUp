version: 1
service: vault-secrets
runbook: https://runbooks.otter.dev/secrets/export-rotation
alerts:
  - id: vault-auth-failures
    severity: high
    description: Burst of Vault AppRole authentication failures for trading wallets
    datasource: vault_audit
    query: type:request AND error:true AND path:"auth/approle/login"
    window: 10m
    threshold: ">=5"
    annotations: {slack_channel: sec-operations, pagerduty_service: secrets-oncall, dashboard: https://grafana.otter.dev/d/vault/secrets}
  - id: vault-export-control-group
    severity: medium
    description: Control group approval triggered for trading secret export
    datasource: vault_audit
    query: type:response AND path:"sys/control-group/request"
    window: 5m
    threshold: ">=1"
    annotations: {slack_channel: sec-operations, audit_ticket_template: OPS-VAULT-CG}
  - id: rotation-overdue
    severity: medium
    description: Trading AppRole secret_id rotation overdue (>=30 days)
    datasource: vault_metrics
    query: approle_secret_age_days{role=~"(sx-trader|azuro-trader)"} >= 30
    window: 1h
    threshold: ">=1"
    annotations: {slack_channel: sec-operations, runbook: https://runbooks.otter.dev/secrets/rotation}
